<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../gc-common/gc-auth.html">
<link rel="import" href="../gc-common/gc-config.html">

<dom-module id="gc-api-ajax">
  <template>
    <gc-config api-uri="{{apiUri}}"></gc-config>
    <gc-auth id="auth" info="{{authInfo}}"></gc-auth>
    <iron-ajax id="ajax" url="[[apiUri]][[url]]" body="[[body]]" loading="{{loading}}" last-response="{{lastResponse}}" method="[[method]]" bubbles="true " content-type="application/json" handle-as="json"></iron-ajax>
  </template>
</dom-module>
<script>
(() => {
  class GcApijax {
    get is() {
      return 'gc-api-ajax';
    }
    get properties() {
      return {
        method: {
          type: String,
          value: 'GET'
        },
        loading: {
          type: Boolean,
          notify: true
        },
        lastResponse: {
          type: Object,
          notify: true
        }
      };
    }
    generateRequest() {
      if (this.authInfo) {
        this.$.ajax.headers = Object.assign({
          'authorization': `${this.authInfo.token}`
        }, this.headers);
      }
      return this.$.ajax.generateRequest();
    }
  }
  Polymer(GcApijax);
})();
</script>
