<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../gc-styles/gc-shared-styles.html">
<link rel="import" href="../gc-layouts/gc-app-shell-layout.html">
<link rel="import" href="../gc-common/gc-auth.html">
<link rel="import" href="../gc-common/gc-lazy-components-behavior.html">
<link rel="import" href="../gc-app/gc-login.html">
<link rel="import" href="../gc-app/gc-account-setup.html">

<dom-module id="gc-app">
  <template>
    <style include="shared-styles"></style>

    <gc-auth id="auth" authenticated="{{authenticated}}"></gc-auth>
    <gc-account-setup></gc-account-setup>
    <gc-login
      route="[[route]]"
      authenticated="[[authenticated]]"
      on-logged-in="_initAuth"
      on-logged-out="_clearAuth">
    </gc-login>

    <gc-active-route pattern="{{activePattern}}" fallback-pattern="/">
      <app-route route="[[route]]" pattern="/user"></app-route>
    </gc-active-route>
    <gc-app-shell-layout>
      <iron-pages selected="[[activePattern]]" attr-for-selected="for-pattern" selected-attribute="active">
        <gc-dashboard-shell for-pattern="/" route="[[route]]"></gc-dashboard-shell>
        <gc-user-shell for-pattern="/user" route="[[route]]"></gc-user-shell>
      </iron-pages>
    </gc-app-shell-layout>
  </template>

  <script>
  (() => {
    'use strict';
    class GcApp {
      get is() {
        return 'gc-app';
      }
      get behaviors() {
        return [
          GitcheeseBehaviors.LazyComponentsBehavior
        ];
      }
      get lazyComponents() {
        return [
          '../gc-dashboard/gc-dashboard-shell.html',
          '../gc-user/gc-user-shell.html',
          '../gc-app/gc-account-setup.html'
        ];
      }
      ready() {
        this.ensureLazyComponents();
      }
      _initAuth(e, data) {
        this.$.auth.init(data.token, data.scopes);
      }
      _clearAuth() {
        this.$.auth.clear();
      }
    }
    Polymer(GcApp);
  })();
  </script>
</dom-module>
