<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../gc-styles/gc-shared-styles.html">
<link rel="import" href="../gc-common/gc-api-ajax.html">
<dom-module id="gc-user-managed-accounts-terms-of-service-info">
  <template>
    <style include="shared-styles"></style>
    <div class="layout horizontal">
      <p class="flex">
        <iron-icon icon="[[_statusIcon]]"></iron-icon>
        Terms Of Service
      </p>

      <paper-icon-button icon="[[_chevronIcon]]" on-tap="toggle"></paper-icon-button>
    </div>
    <iron-collapse opened="[[_expanded]]">

    </iron-collapse>
  </template>
  <script>
  (() => {
    'use strict';
    class GcUserManagedAccountsTermsOfServiceInfo {
      get is() {
        return 'gc-user-managed-accounts-terms-of-service-info';
      }
      get properties() {
        return {
          status: {
            type: String,
            value: 'ok'
          },
          managedAccount: {
            type: Object,
            observer: '_managedAccountChanged'
          },
          _expanded: {
            type: Boolean,
            value: false
          },
          _chevronIcon: {
            type: String,
            computed: '_computeChevronIcon(_expanded)'
          },
          _statusIcon: {
            type: String,
            computed: '_computeStatusIcon(status)'
          }
        };
      }
      toggle() {
        this._expanded = !this._expanded;
      }
      _computeChevronIcon(expanded) {
        return expanded ? 'expand-less' : 'expand-more';
      }
      _computeStatusIcon(status) {
        let icons = {
          'ok': 'check-circle',
          'required': 'report-problem',
          'report-problem': 'report'
        }
        return icons[status];
      }
      _managedAccountChanged(account) {
        if (!account.verification.fields_needed ||
          !account.verification.fields_needed.find((f) => f.startsWith('tos_acceptance.'))) {
          this.status = 'ok';
        } else if (account.verification.disabled_reason) {
          this.status = 'past-due';
        } else {
          this.status = 'required';
        }
      }
    }
    new Polymer(GcUserManagedAccountsTermsOfServiceInfo);
  })();
  </script>
</dom-module>
